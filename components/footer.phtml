<footer>
    <ul>
        <li><p>Author: Milan Ivic</p></li>
        <li><p><a href="mailto:milanivic1995@gmail.com">milanivic1995@gmail.com</a></p></li>
        <li><p>&copy; All rights reserved</p></li>
  </ul>
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
function openTab(evt, tabName) {
  var i, x, tablinks;
  x = document.getElementsByClassName("tab");
  for (i = 0; i < x.length; i++) {
    x[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < x.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}


// Statistics

// Show single player and his stats   /    isto ovako i select formu za Novi Mec ispisati ovde?

function showPlayer(player_id_form){
  if (player_id_form == "") {
    document.getElementById("player_table").innerHTML = "";
    return;
  } else {
    $.ajax({
      url: 'Futsal/statistics/show_Player.php?player_id=' + player_id_form,
      type: 'GET',
      dataType: 'JSON',
      success: function(response){
        var len = response.length;
        for(var i=0; i<len; i++){
          var player_id_sql_table = response[i].player_id;
          var first_name = response[i].first_name;
          var last_name = response[i].last_name;
          var nick_name = response[i].nick_name;
          var goals = response[i].goals;
          var assists = response[i].assists; 
          var date = response[i].date;

          var table = 
            "<table>" +
            "<thead>" +
            "<td>IME</td>" +
            "<td>PREZIME</td>" +
            "<td>NADIMAK</td>" +
            "<td>GOLOVI</td>" +
            "<td>ASISTENCIJE</td>" +
            "<td>PRISTUPIO</td>" +
            "</thead>" +
            "<tbody>" +
            "<td>" + first_name + "</td>" +
            "<td>" + last_name + "</td>" +
            "<td>" + nick_name + "</td>" +
            "<td>" + goals + "</td>" +
            "<td>" + assists + "</td>" +
            "<td>" + date + "</td>" +
            "</tbody>" +
            "</table>";

          document.getElementById("player_table").innerHTML = table;
        }
      }
    });
  }
}

// Show game stats
function showGame(str) {
  if (str == "") {
    document.getElementById("game_stats").innerHTML = "";
    return;
  } else {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("game_stats").innerHTML = this.responseText;
        }
      };
      xmlhttp.open("GET","Futsal/statistics/show_Game.php?g="+str, true);
      xmlhttp.send();
    }
}



// New Match

// Fetching players that aren't in a team
$(document).ready(function(){
  $.ajax({
    url: 'Futsal/new_match/show_player_form.php',
    type: 'GET',
    dataType: 'JSON',
    success: function(response){
      $.each(response, function(key,value) {
        for(var i=1; i<=2; i++) {
          var option = "<option value='" + value.id + "'>" + "<span>" + value.nick_name + "</span>" + "</option>";
          $("#"+ i + " optgroup").append(option);
        }
      });
    }
  });
});

// Insert players into live game table
function insert_player_into_live_game_table(player, team) {
  $.ajax({
    url: 'Futsal/new_match/insert_player_into_live_table_2.php',
    type: 'get',
    data: {
      player_id: player,
      team_id: team
    },
    error: function() {
      alert("function 'insert_player_into_live_game_table()' ERROR");
    }
  }).done(
    function get_live_game_table_after_selecting_player() {
      $.ajax({
        url: 'Futsal/new_match/get_live_game_table.php?team_id=' + team,
        type: 'get',
        dataType: 'JSON',
        success: function(response){
          var table =
          "<thead id='thead_" + team + "'>" +
          "<tr>" +
          "<td>TIM</td>" +
          "<td>PLAYER_ID</td>" +
          "<td>IME</td>" +
          "<td>PREZIME</td>" +
          "<td>NADIMAK</td>" +
          "<td>GOLOVI</td>" +
          "<td>ASISTENCIJE</td>" +
          "<td>DATUM</td>" +
          "<td>GAME_ID</td>" +
          "</tr>" +
          "</thead>" +

          "<tbody id='tbody_" + team + "'>" +
          "</tbody>";

          document.getElementById("table_" + team).innerHTML = table;

          $.each(response, function(key,value) {
            var tr =
            "<tr>" +
            "<td>" + value.team_id + "</td>" +
            "<td>" + value.player_id + "</td>" +
            "<td>" + value.first_name + "</td>" +
            "<td>" + value.last_name + "</td>" +
            "<td>" + value.nick_name + "</td>" +
            "<td>" + value.goals + "</td>" +
            "<td>" + value.assists + "</td>" +
            "<td>" + value.date_of_game + "</td>" +
            "<td>" + value.game_id + "</td>"
            "</tr>";

            $("#table_" + team + " tbody").append(tr);
          });
            },
        error: function() {
          alert("function 'get_live_game_table_after_selecting_player()' ERROR");
        }
      }).done(
        function fetch_players_again() {
          $.ajax({
            url: 'Futsal/new_match/show_player_form.php',
            type: 'GET',
            dataType: 'JSON',
            success: function(response){
              var optgroup_empty =
              "<optgroup label='Svi igrači'>" +
              "</optgroup>";

              var all_forms = document.querySelectorAll(".unselected_players");
              for (let i = 0; i < all_forms.length; i++) {
                all_forms[i].innerHTML = optgroup_empty;
              }

              $.each(response, function(key,value) {
                for(var i=1; i<=2; i++) {
                  var option = "<option value='" + value.id + "'>" + "<span>" + value.nick_name + "</span>" + "</option>";
                  $("#"+ i + " optgroup").append(option);
                }
              });
            },
            error: function() {
              alert("function 'fetch_players_again()' ERROR");
              }
          });
        }
      )
    }
  );
};

// live game table on page load
$(document).ready(function(){
  for (let i = 1; i <= 2; i++) {
    $.ajax({
      url: 'Futsal/new_match/get_live_game_table.php?team_id=' + i,
      type: 'get',
      dataType: 'JSON',
      success: function(response){
        var tr_head =
        "<tr>" +
        "<td>TIM</td>" +
        "<td>PLAYER_ID</td>" +
        "<td>IME</td>" +
        "<td>PREZIME</td>" +
        "<td>NADIMAK</td>" +
        "<td>GOLOVI</td>" +
        "<td>ASISTENCIJE</td>" +
        "<td>DATUM</td>" +
        "<td>GAME_ID</td>" +
        "</tr>";

        $("#table_" + i + " thead").append(tr_head);
        $.each(response, function(key,value) {
          var tr =
          "<tr>" +
          "<td>" + value.team_id + "</td>" +
          "<td>" + value.player_id + "</td>" +
          "<td>" + value.first_name + "</td>" +
          "<td>" + value.last_name + "</td>" +
          "<td>" + value.nick_name + "</td>" +
          "<td>" + value.goals + "</td>" +
          "<td>" + value.assists + "</td>" +
          "<td>" + value.date_of_game + "</td>" +
          "<td>" + value.game_id + "</td>"
          "</tr>";

          $("#table_" + i + " tbody").append(tr);
        });
      },
      error: function() {
        alert("live table onload ERROR");
      }
    });
  }
});


// fetching players who aren't in a team
// $.ajax({
//   url: 'Futsal/new_match/show_player_form.php',
//   type: 'get',
//   dataType: 'JSON',
//   success: function(response){
//     var len = response.length;
//     for(var i=0; i<len; i++){
//       var id = response[i].id;
//       var first_name = response[i].first_name;
//       var last_name = response[i].last_name;
//       var option_str = "<option value=" + id + ">" + first_name + " " + last_name + "</option>";
//       $(".player_form optgroup").append(option_str);
//     }
//   }
// });

// onchange event in form above
// function insert_player_into_live_game_table(opt_value, team) {
//   if (opt_value == "") {
//     document.getElementById("live_game").innerHTML = "";
//     return;
//   } else {
//       var xmlhttp = new XMLHttpRequest();
//       xmlhttp.onreadystatechange = function() {
//         if (this.readyState == 4 && this.status == 200) {
//           document.getElementById("live_game").innerHTML = this.responseText;
//         }
//       };
//       xmlhttp.open("GET","Futsal/new_match/insert_player_into_live_game_table.php?insert_player=" + opt_value + "&team_id=" + team, true);
//       xmlhttp.send();
//     }
// }

// function add_remove_goal_assist() {
//   var xmlhttp = new XMLHttpRequest();
//   xmlhttp.onreadystatechange = function() {
//     if (this.readyState == 4 && this.status == 200) {
//     document.getElementById("live_game").innerHTML = this.responseText;
//     }
//   };
//   xmlhttp.open("GET","Futsal/new_match/echo.php?g=goal_assist", true);
//   xmlhttp.send();
//   preventDefault()
//   fetch_players(); 
// }

// function fetch_players() {
//   var xmlhttp = new XMLHttpRequest();
//   xmlhttp.onreadystatechange = function() {
//     if (this.readyState == 4 && this.status == 200) {
//       document.getElementById("fetch_players").innerHTML = this.responseText;
//     }
//   };
//   xmlhttp.open("GET","Futsal/new_match/echo.php?fetch_list=fetch", true);
//   xmlhttp.send();
// }



</script>
</body>
</html>
